'use strict'

const mysql = require('../index')()

// console.log(mysql);

mysql.config({
  host     : 'localhost',
  database : 'test-mysql',
  user     : 'test',
  password : 'test',
  port     : '8889',
  multipleStatements: true
})

console.log('MYSQL TESTING:');

const handler = async () => {
  try {
    //await mysql.connect()

    await mysql.killZombieConnections(1)

    // let processList = await mysql.query('SELECT * FROM information_schema.processlist WHERE command = "Sleep" AND time > 1 ORDER BY id')
    // console.log('Processes:',processList.results.length);
    // for (let row in processList.results) {
    //   //mysql.query('CALL mysql.rds_kill(?)',[row.id])
    //   console.log('ROW:',processList.results[row].ID)
    //   console.log(JSON.stringify(processList.results[row]))
    //   let result = await mysql.query('KILL ?',[processList.results[row].ID])
    //   console.log('KILL RESULT',result);
    // }
    await mysql.quit()
  } catch(e) {
    console.log('error:',e.message);
  }


}

handler()
